@page "/CashInflow"
@using MauiApp1.Models
@inject NavigationManager Navigation
@inject UserService UserService

<h3 class="text-3xl font-bold mb-6 text-center text-orange-700">Cash Inflow</h3>

<form class="space-y-6 bg-white p-8 rounded-lg shadow-lg max-w-lg mx-auto">
    <div>
        <label for="title" class="block text-lg font-medium text-gray-800">Title:</label>
        <input type="text" id="title" name="title" @bind="Title" required
               class="mt-2 block w-full px-4 py-3 border-2 border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600" />
    </div>

    <div>
        <label for="tags" class="block text-lg font-medium text-gray-800">Tags:</label>
        <input type="text" id="tags" name="tags" @bind="Tags" required
               class="mt-2 block w-full px-4 py-3 border-2 border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600" />
    </div>

    <div>
        <label for="credit" class="block text-lg font-medium text-gray-800">Credit:</label>
        <input type="number" id="credit" name="credit" @bind="Credit" required
               class="mt-2 block w-full px-4 py-3 border-2 border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-600 focus:border-orange-600"
               step="any" min="0" />
    </div>

    <div>
        <label for="description" class="block text-lg font-medium text-gray-800">Description:</label>
        <textarea id="description" name="description" @bind="Description" rows="4" required
                  class="mt-2 block w-full px-4 py-3 border-2 border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-600 focus:border-orange-600"></textarea>
    </div>

    <div class="flex justify-center">
        <button type="button" @onclick="HandleCashInflow" class="px-6 py-3 bg-orange-600 text-black font-semibold rounded-full shadow-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition duration-300 ease-in-out transform hover:scale-105">
            Submit
        </button>
    </div>

</form>

<!-- Display Total Cash Inflow -->
<div class="mt-6 text-center">
    <h4 class="text-xl font-medium text-gray-800">Total Cash Inflow: </h4>
    <p class="text-2xl font-bold text-orange-700">@TotalCashInflow</p>
</div>

@code {
    private string Title { get; set; }
    private string Tags { get; set; }
    private decimal Credit { get; set; }
    private string Description { get; set; }

    // Property to hold the total cash inflow
    private decimal TotalCashInflow => GetTotalCashInflow();

    private async Task HandleCashInflow()
    {
        // Validate input fields
        if (string.IsNullOrWhiteSpace(Title) || string.IsNullOrWhiteSpace(Tags) || Credit <= 0 || string.IsNullOrWhiteSpace(Description))
        {
            return; // Handle validation failure as needed
        }

        // Create a new Transaction
        var transaction = new Transaction
            {
                Id = Guid.NewGuid(),
                Title = Title,
                Tags = Tags,
                Credit = Credit,
                Debit = 0, // Set Debit to 0 as this is a cash inflow
                Description = Description,
                Date = DateTime.Now
            };

        // Load existing data and add the new transaction
        var appData = UserService.LoadData();
        appData.Transactions.Add(transaction);

        // Save updated data
        UserService.SaveData(appData);

        // Navigate to the transactions page
        Navigation.NavigateTo("/mytransaction");
    }

    // Method to calculate the total cash inflow
    private decimal GetTotalCashInflow()
    {
        var appData = UserService.LoadData();
        if (appData != null)
        {
            // Sum up all credit amounts (cash inflows) from transactions
            return appData.Transactions.Where(t => t.Credit > 0).Sum(t => t.Credit);
        }
        return 0; // Return 0 if no transactions found or data is empty
    }
}
